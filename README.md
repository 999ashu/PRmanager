# PR Manager

Сервис автоматического назначения ревьюеров для Pull Request'ов, реализованный на фреймворке userver C++ с PostgreSQL.

## Описание

Я выбрал самый знакомый и удобный для меня фреймворк - userver, за основу взят шаблонный проект с PostgreSQL. Инструментарий фреймворка позволил быстро добавить базовые юнит тесты для парсинга/сериализации объектов, а также интеграционные тесты на PyTest для всего сервиса.

При создании PR выбираются до двух случайных ревьюеров из команды автора (без автора); при переназначении выбирают замену из команды заменяемого ревьювера, исключая автора и текущих ревьюеров; если кандидатов нет — возвращается ошибка NO_CANDIDATE (HTTP 409). Принятые решения: строковые ID (TEXT), выбор через std::sample, нельзя переназначать после MERGED, merge идемпотентен (merged_at не меняется при повторных вызовах), при добавлении пользователя используется ON CONFLICT DO UPDATE, критические операции выполняются в транзакциях, добавлены индексы на часто используемые поля.


Полная спецификация API доступна в файле [openapi.yml](../openapi.yml).
### Структура проекта

```
PRmanager/
├── src/
│   ├── main.cpp              # Точка входа приложения
│   ├── handlers.hpp/cpp      # HTTP ручки
│   └── models.hpp/cpp        # Структуры для данных
├── configs/
│   ├── static_config.yaml    # Конфигурация сервиса
│   └── config_vars.yaml      # Переменные окружения
├── postgresql/
│   ├── schemas/              # SQL схемы для инициализации
│   └── migrations/           # SQL миграции
├── tests/
│   └── test_prmanager.py     # Интеграционные тесты
└── docker-compose.yml        # Конфигурация Docker
```
## Работа с сервисом

### Запуск сервиса

Чтобы быстро поднять инстанс сервиса на `http://localhost:8080` выполните:

```bash
docker compose up
```

### Разработка и тестирование
автотестирование произойдет при первой сборке в docker compose, но можно сделать это в ручном режиме открыв проект внутри devcontainer
```bash
cd PRmanager
make docker-build-release
make docker-test-release
```